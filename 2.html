<!DOCTYPE html>
<html>
<body>

<button onclick="start()">Start Listening</button>

<h3>Received:</h3>
<div id="output"></div>

<script>

const ctx = new (window.AudioContext || window.webkitAudioContext)();

let analyser;
let data;
let listening = false;
let lastFreq = 0;

async function start(){

const stream = await navigator.mediaDevices.getUserMedia({
audio: {
echoCancellation: true,
noiseSuppression: true,
autoGainControl: true
}
});

const source = ctx.createMediaStreamSource(stream);

analyser = ctx.createAnalyser();
analyser.fftSize = 2048;

source.connect(analyser);

data = new Uint8Array(analyser.frequencyBinCount);

setInterval(read, 300);

}

function read(){

analyser.getByteFrequencyData(data);

let max = 0;
let index = 0;

for(let i=0;i<data.length;i++){

if(data[i] > max){

max = data[i];
index = i;

}

}

if(max < 200) return;

let freq = index * ctx.sampleRate / analyser.fftSize;


// ignore same frequency repeat
if(Math.abs(freq - lastFreq) < 20) return;

lastFreq = freq;


// START
if(freq > 390 && freq < 410){

listening = true;

return;

}


// END
if(freq > 490 && freq < 510){

listening = false;

return;

}


if(!listening) return;


let charCode = Math.round((freq - 600) / 10);

if(charCode >= 32 && charCode <= 126){

document.getElementById("output").innerText +=
String.fromCharCode(charCode);

}

}

</script>

</body>
</html>
